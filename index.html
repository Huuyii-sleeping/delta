<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <div class="toolbar" style="margin-bottom: 10px">
      <button
        id="btn-bold"
        onmousedown="event.preventDefault(); editor.format('bold', true)"
      >
        Bold
      </button>
      <button
        onmousedown="event.preventDefault(); editor.format('italic', true)"
      >
        Em
      </button>
      <button
        onmousedown="event.preventDefault(); editor.format('color', 'red')"
      >
        Red
      </button>
      <button onmousedown="event.preventDefault(); editor.format('bold', null)">
        Clear Bold
      </button>
      <button
        onmousedown="event.preventDefault(); editor.format('italic', null)"
      >
        Clear Em
      </button>
      <button
        onmousedown="event.preventDefault(); editor.formatLine('header', 1)"
      >
        H1
      </button>
      <button
        onmousedown="event.preventDefault(); editor.formatLine('header', 2)"
      >
        H2
      </button>
      <button
        onmousedown="event.preventDefault(); editor.formatLine('header', null)"
      >
        Clear Header
      </button>
      <button onmousedown="event.preventDefault(); addLink()">Link</button>
      <button
        onmousedown="event.preventDefault(); window.editor.format('link', null)"
      >
        Unlink
      </button>
      <button
        onmousedown="event.preventDefault(); editor.formatLine('list', 'bullet')"
      >
        Bullet
      </button>
      <button
        onmousedown="event.preventDefault(); editor.formatLine('list', 'ordered')"
      >
        Number
      </button>
      <button
        onmousedown="event.preventDefault(); editor.formatLine('list', 'null')"
      >
        No List
      </button>
      <button onmousedown="event.preventDefault(); insertImageBtn()">
        插入图片
      </button>
      <button onmousedown="event.preventDefault(); editor.insertCodeBlock()">
        Insert Code Block
      </button>
      <button onmousedown="event.preventDefault(); editor.format('code', true)">
        Inline Code ``
      </button>
      <button onmousedown="event.preventDefault(); search()">搜索</button>
      <button onmousedown="event.preventDefault(); replace()">替换</button>
      <button onclick="save()">保存到控制台</button>
      <button onclick="load()">加载示例数据</button>
      <button onclick="window.editor.enable()">启用编辑</button>
      <button onclick="window.editor.disable()">只读模式</button>
    </div>
    <div id="editor" data-placeholder="请输入正文..."></div>
    <script type="module">
      import { Editor } from "./Editor/Editor.ts";

      const editor = new Editor("#editor");

      window.editor = editor;
      window.insertImageBtn = insertImageBtn;
      window.save = save;
      window.load = load;
      window.addLink = addLink;
      window.search = search;
      window.replace = replace
      window.editor.on("selection-change", (range) => {
        if (!range) return;
        const formats = window.editor.getFormat();

        const boldBtn = document.getElementById("btn-bold");
        if (formats.bold) {
          boldBtn.style.backgroundColor = "#ccc";
        } else {
          boldBtn.style.backgroundColor = "";
        }
      });

      function replace() {
        const replaceContent = prompt("请输入替换内容")
        if(!replaceContent) return 
        editor.replace("", replaceContent)
      }

      function search() {
        const searchContent = prompt("请输入搜索内容");
        if(!searchContent) return 
        editor.search(searchContent);
      }

      function addLink() {
        const url = prompt("请输入链接地址", "https://");
        if (url) {
          window.editor.format("link", url);
        }
      }

      function insertImageBtn() {
        const url = prompt("请输入图片URL", "https://via.placeholder.com/150");
        if (url) {
          window.editor.insertImage(url);
        }
      }

      function save() {
        const json = window.editor.getJSON();
        console.log("Save JSON:", json);
      }

      function load() {
        const data = [
          { insert: "Hello " },
          { insert: "World", attributes: { bold: true } },
          { insert: "\n", attributes: { header: 1 } },
          { insert: "This is a list:\n" },
          { insert: "Item 1" },
          { insert: "\n", attributes: { list: "bullet" } },
          { insert: "Item 2" },
          { insert: "\n", attributes: { list: "bullet" } },
        ];
        window.editor.setContents(data);
      }
    </script>
  </body>
</html>
